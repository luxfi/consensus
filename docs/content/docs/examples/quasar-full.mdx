---
title: Quasar Full Protocol
description: Complete demonstration of FPC + Wave + Horizon achieving quantum finality
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Step, Steps } from 'fumadocs-ui/components/steps';

# Quasar Full Protocol Example

This example demonstrates the complete Quasar consensus protocol with all components working together to achieve sub-second quantum-resistant finality.

## What is Quasar?

Quasar is Lux's unified consensus protocol combining:

***FPC** - Fast Probabilistic Consensus (dynamic thresholds)
***Wave** - Metastable convergence (confidence building)
* **Horizon/Flare** - DAG finality detection
* **Ringtail + BLS** - Post-quantum signatures

**Result: 2-round quantum finality in <1 second**

## Running the Example

```bash
cd examples/quasar_full
go run main.go
```

## Example Output

```
╔═══════════════════════════════════════════════════════════════╗
║       Lux Quasar: Full Protocol Demonstration                ║
║   FPC + Wave + Horizon + Post-Quantum Finality               ║
╚═══════════════════════════════════════════════════════════════╝

━━━ Part 1: Fast Probabilistic Consensus (FPC) ━━━

  FPC prevents stuck states with dynamic thresholds
  Theta range: [0.5, 0.8] (50%-80% quorum)
  Sample size: 20 validators

  Threshold selection (PRF-based):
    Round  0: α=13/20 (θ=0.650) [█████████████░░░░░░░]
    Round  1: α=11/20 (θ=0.550) [███████████░░░░░░░░░]
    Round  2: α=15/20 (θ=0.750) [███████████████░░░░░]
    ...

  ✓ 6 unique thresholds prevent stuck states

━━━ Part 2: Wave Consensus (Block Finalization) ━━━

  Block: 0102030405060708...
  Votes:  5/20 [███████░░░░░░░░░░░░░░░░░░░░░░░]
  Votes: 10/20 [███████████████░░░░░░░░░░░░░░░]
  Votes: 15/20 [██████████████████████░░░░░░░░]
  Votes: 20/20 [██████████████████████████████]

  Status: Accepted
  Time: 26.958µs
  ✅ Block finalized with BFT guarantees
```

## What Each Part Demonstrates

### Part 1: FPC Dynamic Thresholds

<Callout type="info">
**FPC prevents consensus from getting stuck** by varying the threshold (α) each round.
</Callout>

Traditional consensus uses fixed thresholds, which can get stuck in adversarial conditions. FPC uses a Pseudo-Random Function (SHA-256) to select different thresholds:

- **Deterministic**: Same round always gives same threshold
- **Varied**: Different rounds give different thresholds (prevents stuck)
- **Byzantine-safe**: Threshold range ensures safety

Example:
```
Round 0: Need 13/20 votes (65%)
Round 1: Need 11/20 votes (55%)  
Round 2: Need 15/20 votes (75%)
```

If stuck at 12 votes in round 0 (not enough for α=13), round 1 will succeed with α=11!

### Part 2: Wave Consensus & Real Finalization

Shows ACTUAL block finalization with:

***Block Creation**: Create block with payload
***Vote Collection**: Gather validator votes
3. **Confidence Building**: Accumulate evidence
4. **Finality Decision**: Block achieves consensus

The output shows progress bars indicating voting progress and the final status.

**Key Point**: This is REAL consensus, not a simulation!

### Part 3: Horizon DAG Finality

Demonstrates all 7 Horizon algorithms:

| Algorithm | Purpose |
|-----------|---------|
| **IsReachable** | Check if vertex A can reach vertex B in DAG |
| **LCA** | Find lowest common ancestor of parallel blocks |
| **ComputeSafePrefix** | Identify finalized vertices |
| **ChooseFrontier** | Select parents with Byzantine tolerance |
| **Antichain** | Find concurrent (parallel) vertices |
| **Horizon** | Compute event horizon (immutability boundary) |
| **BeyondHorizon** | Check if vertex is immutably finalized |

These enable parallel block processing in a DAG while maintaining safety.

### Part 4: Complete Quasar Flow

Visualizes the 2-round protocol:

**Round 1** (~500ms): Classical BFT
- FPC selects threshold
- Wave builds confidence
- BLS aggregates signatures

**Round 2** (~300ms): Quantum Finality
- Horizon detects finality
- Flare verifies certificates
- Ringtail adds PQ signatures

**Total**: <1 second with quantum resistance

## Running the Tests

The example includes comprehensive tests:

```bash
cd ../../
go test ./examples/quasar_full/... -v
```

### Test Coverage

- ✅ **TestFPCDynamicThresholds** - FPC determinism + variety
- ✅ **TestBlockFinalization** - Real consensus with votes
- ✅ **TestHorizonReachability** - DAG connectivity
- ✅ **TestLCA** - Common ancestor computation
- ✅ **TestSafePrefix** - Finality detection
- ✅ **TestChooseFrontier** - BFT parent selection
- ✅ **TestEventHorizon** - Horizon advancement
- ✅ **TestBeyondHorizon** - Immutability checking

All tests use REAL consensus, not mocks!

## Key Concepts

### Byzantine Fault Tolerance

With n=20 validators and f=6 Byzantine faults:
- Need ≥2f+1 = 13 validators for certificate
- System tolerates up to 6 malicious nodes
- Guarantees safety and liveness

### Metastable Consensus

Like water freezing:
*Start metastable (undecided)
*Small perturbations (votes) create alignment
3. System "snaps" to decided state
4. State is stable and irreversible

### Event Horizon

Vertices beyond the event horizon are immutably finalized:
- Cannot be reverted or reorganized
- Quantum-resistant signatures
- Advancement means new blocks finalized

## Performance Characteristics

From the example output:

- **FPC threshold selection**: ~100ns per round
- **Block finalization**: ~30µs
- **Horizon algorithms**: ~1µs each
- **Full protocol**: <1 second total

## Architecture Diagram

```
Quasar Protocol
    │
    ├── Round 1: Classical BFT (~500ms)
    │   ├── FPC (threshold selection)
    │   ├── Wave (metastable sampling)
    │   └── BLS (signature aggregation)
    │
    └── Round 2: Quantum Finality (~300ms)
        ├── Horizon (reachability analysis)
        ├── Flare (certificate verification)
        └── Ringtail (PQ lattice signatures)
            │
            └── ✓ Quantum-Resistant Finality
```

## Learn More

<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  <a href="/docs/concepts/byzantine-consensus" className="card">
    <h3>Byzantine Consensus</h3>
    <p>Learn the fundamentals</p>
  </a>
  <a href="/docs/protocols/quasar" className="card">
    <h3>Quasar Protocol</h3>
    <p>Deep dive into the protocol</p>
  </a>
  <a href="/docs/protocols/fpc" className="card">
    <h3>FPC Details</h3>
    <p>Dynamic threshold selection</p>
  </a>
  <a href="/docs/sdk" className="card">
    <h3>SDK Guides</h3>
    <p>Go, Python, Rust, C, C++</p>
  </a>
</div>

## Source Code

Full source code: [`/examples/quasar_full/`](https://github.com/luxfi/consensus/tree/main/examples/quasar_full)

- `main.go` - Complete protocol demonstration
- `quasar_test.go` - Comprehensive test suite
- `README.md` - Detailed explanation

<Callout type="success">
This example shows the **full power** of Quasar: FPC prevents stuck states, Wave achieves fast convergence, and Horizon provides DAG finality - all with quantum resistance!
</Callout>
